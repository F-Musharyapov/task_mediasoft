
### **1. Контроллер товаров (warehouse-controller)**
## ID 1.1.
#### **Создать товар**

**Предусловия:** База данных товаров пуста или доступна для записи.\
**Шаги:**
1. Сформировать HTTP POST запрос на эндпоинт `/products`.
2. Установить заголовок `Content-Type: application/json`.
3. В теле запроса передать валидный JSON объект с данными нового товара:
    ```json
    {
      "name": "Apple",
      "article": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "category": "VEGETABLES",
      "dictionary": "test dict",
      "price": 1,
      "qty": 1
    }
    ```
4. Отправить запрос.\
   **Ожидаемый результат:**
*   **Код ответа:** `201 Created`.
*   **Тело ответа:** Содержит JSON объект с данными вида:
    ```json
    {
      "name": "string",
      "article": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "category": "string",
      "price": 0,
      "qty": 0,
      "insertedAt": "2025-09-22T12:45:45.370Z",
      "last_qty_changed": "2025-09-22T12:45:45.370Z",
      "currency": "USD"
    }
    ```
---
## ID 1.2.
#### **Получить список товаров**
**Предусловия:** В базе данных существует несколько товаров (например, 2).\
**Шаги:**
1. Сформировать HTTP GET запрос на эндпоинт `/products`.
2. Отправить запрос.\
   **Ожидаемый результат:**
*   **Код ответа:** `200 OK`.
*   **Тело ответа:** Массив JSON, содержащий объекты всех существующих товаров. Каждый объект должен содержать все свои поля. Структура данных каждого товара должна быть валидной. Пример ответа запроса:
    ```json
    [
      {
        "name": "string",
        "article": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "category": "string",
        "price": 0,
        "qty": 0,
        "insertedAt": "2025-09-22T12:57:44.842Z",
        "last_qty_changed": "2025-09-22T12:57:44.842Z",
        "currency": "USD"
      },
      {
        "name": "string",
        "article": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "category": "string",
        "price": 0,
        "qty": 0,
        "insertedAt": "2025-09-22T12:57:44.842Z",
        "last_qty_changed": "2025-09-22T12:57:44.842Z",
        "currency": "USD"
      }
    ]
    ```
---
## ID 1.3.
#### **Найти товар по ID**
**Предусловия:** В базе данных существует товар с известным ID (например, `3fa85f64-5717-4562-b3fc-2c963f66afa6`).\
**Шаги:**
1. Сформировать HTTP GET запрос на эндпоинт `/products/{id}`.
2. Отправить запрос.\
   **Ожидаемый результат:**
*   **Код ответа:** `200 OK`.
*   **Тело ответа:** JSON объект, содержащий данные товара с указанным ID. Значения всех полей должны соответствовать данным, находящимся в базе. Пример тела ответа:
    ```json
    {
      "name": "string",
      "article": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "category": "string",
      "price": 0,
      "qty": 0,
      "insertedAt": "2025-09-22T13:04:47.562Z",
      "last_qty_changed": "2025-09-22T13:04:47.562Z",
      "currency": "USD"
    }
    ```
    
---
## ID 1.4.
#### **Обновление товара**
**Предусловия:** В базе данных существует товар с известным ID и исходными данными (например, ценой = 100.00, количеством = 5.00).\
**Шаги:**
1. Сформировать HTTP PATCH запрос на эндпоинт `/products`.
2. Установить заголовок `Content-Type: application/json`.
3. В теле запроса передать JSON объект с полем `id` и полями для обновления:
    ```json
       {
        "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "name": "Orange",
        "category": "VEGETABLES",
        "dictionary": "Test Orange",
        "price": 1,
        "qty": 1
       }
    ```
4. Отправить запрос.\
   **Ожидаемый результат:**
*   **Код ответа:** `200 OK`.
*   **Тело ответа:** JSON объект с обновленными данными товара. Поле `last_qty_changed` должно обновиться.
    ```json 
    {
      "name": "string",
      "article": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "category": "string",
      "price": 1,
      "qty": 1,
      "insertedAt": "2025-09-22T13:05:46.757Z",
      "last_qty_changed": "2025-09-22T13:05:46.757Z",
      "currency": "USD"
    }
    ```
    
---
## ID 1.5.
#### **Удаление товара по ID**
**Предусловия:** В базе данных существует товар с известным ID (например, `f47ac10b-58cc-4372-a567-0e02b2c3d479`).\
**Шаги:**
1. Сформировать HTTP DELETE запрос на эндпоинт `/products/{id}`.
2. Отправить запрос.\
   **Ожидаемый результат:**
*   **Код ответа:** `200 OK` (тело ответа отсутствует).
*   **Проверка:** Удаленный товар отсутствует в базе данных.

---

### **2. Контроллер заказов (order-controller)**
## ID 2.1.
#### **Создание заказа**
**Предусловия:** В базе данных существует customer с известным ID и продукты для заказа. Количество доступного товара в таблице `product` должно хватать для заказа.
\
**Шаги:**
1. Сформировать HTTP POST запрос на эндпоинт `/order`.
2. Установить заголовок `Content-Type: application/json`.
3. В теле запроса передать валидный JSON объект вида:
    ```json
    {
      "customer_id": 777,
      "delivery_address": "г. Москва, ул. Примерная, д. 1, кв. 50",
      "ordered_products": [
        {
          "product_id": "prod-111",
          "qty": 2.00
        },
        {
          "product_id": "prod-222",
          "qty": 1.00
        }
      ]
    }
    ```
4. Отправить запрос.

**Ожидаемый результат:**
* **Код ответа:** `201 Created`.
* **Тело ответа:** Содержит JSON объект созданного заказа, автоматически сгенерированным `id` в формета UUID, вида: `3fa85f64-5717-4562-b3fc-2c963f66afa6`
* Количество товаров (`qty`) для продуктов в таблице `product` должно уменьшиться на заказанное количество. 
* Заказ создается в таблице ORDER и создается резерв товаров в таблице `ordered_product`. Данные, отправленные в запросе совпадают с данными заказа в базе данных. 
* Статус заказа в таблице `/order/` - `"CREATED"`
---
## ID 2.2.
#### **Получение заказа по ID**
**Предусловия:** В базе данных существует customer с известным ID, продукты для заказа, заказ с известным ID и статусом `"CREATED"`.\
**Шаги:**
1. Сформировать HTTP GET запрос на эндпоинт `/order/{id}`.
2. Отправить запрос.
   **Ожидаемый результат:**
*   **Код ответа:** `200 OK`.
*   **Тело ответа:** Полный JSON объект заказа, дополнительным полем totalPrice:
    ```json
    {
      "orderId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "products": [
        {
          "name": "string",
          "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
          "price": 0,
          "qty": 0
        }
      ],
      "totalPrice": 0
    }
    ```
* Данные из тела ответа совпадают с данными в базе данных.

---
## ID 2.3.
#### **Редактирование заказа по ID**
**Предусловия:** В базе данных существует customer с известным ID, продукты для заказа, заказ с известным ID и статусом `"CREATED"`.\
**Шаги:**
1. Сформировать HTTP PATCH запрос на эндпоинт `/order/{id}`.
2. Установить заголовок `Content-Type: application/json`.
3. В теле запроса передать JSON объект с полем для обновления:
    ```json
    {
      "products": [
        {
          "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
          "qty": 10
        }
      ]
    }
    ```
4. Отправить запрос.\
   **Ожидаемый результат:**
*  **Код ответа:** `204`.
*  Применились изменения в заказе в базе данных. 
*  Количество продуктов в таблице `product` обновилось.

---
## ID 2.4.
#### **Удаление заказа по ID**
**Предусловия:** В базе данных существует customer с известным ID, продукты для заказа, заказ с известным ID и статусом `"CREATED"`.\
**Шаги:**
1. Запомнить текущее количество товаров, входящих в заказ.
2. Сформировать HTTP DELETE запрос на эндпоинт `/order/{id}`.
3. Отправить запрос.
   **Ожидаемый результат:**
* **Код ответа:** `200 OK`.
* Статус заказа в таблице `order` меняется на CANCELLED.
* Количество товаров (`qty`) в таблице `product` для всех позиций, которые были в этом заказе, возвращено. 
* Записи в промежуточной таблице `ordered_product` для этого заказа удалены.